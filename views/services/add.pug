extends ../layout

block main
  section#add-service.section
    .container
      .row.justify-content-center.mt-5
        .col-lg-6
          .title.text-center
            h2
              | Add&nbsp
              b Service
            span.title-border
              i.mdi.mdi-set-none

      form#add-service-form(method='post', name='add-service-form')
        script(src='https://checkout.stripe.com/checkout.js')
        input(type='hidden', name='_csrf', value=_csrf)
        input(type='hidden', name='selectedServiceId', id='selectedServiceId')
        input(type='hidden', name='stripetoken', id='stripetoken')
        .row.mt-4.pt-4
          .col-lg-8
            .row
              for service in services
                .col-2.mt-3
                  .default-service-box(data-id=service.id, data-name=service.name)
                    img.service-logo.mx-auto.d-block.img-fluid(src=service.logo, alt=service.name)

          .col-lg-3.offset-md-1.mt-3
            .row
              .col-md
                .form-group
                  label(for='service') Service
                  input#service.form-control(name='service', type='text', placeholder='Click on a logo', disabled)
            .row
              .col-md
                .form-group
                  label(for='user') User name
                  input#user.form-control(name='user', type='text', placeholder='Your user name...', required, disabled)
            .row
              .col-md
                .form-group
                  label(for='password') Password
                  input#password.form-control(name='password', type='password', placeholder='Your password...', required, disabled)
            .row
              .col-md
                input#add-service-button.submitBnt.btn.btn-primary.btn-custom.btn-block(type='submit', value='Add Service')

        if (user.services.length === 3)
          script(type='text/javascript').
            var handler = StripeCheckout.configure({
              key: '#{process.env.STRIPE_PKEY}',
              image: 'https://stripe.com/img/documentation/checkout/marketplace.png',
              locale: 'auto',
              token: function(token) {
                console.log(token)
              }
            });

            document.getElementById('add-service-button').addEventListener('click', function(e) {
              handler.open({
                name: 'Pailan',
                description: 'Service Subscription',
                zipCode: true,
                billingAddress: true,
                email: '#{user.email}',
                image: 'https://stripe.com/img/documentation/checkout/marketplace.png',
                locale: 'auto',
              });
              e.preventDefault();
            });

            window.addEventListener('popstate', function() {
              handler.close();
            });